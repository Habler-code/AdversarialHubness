# Gold Standard Multi-Index Configuration
# Implements production "gold standard" architecture:
# - Parallel retrieval from separate indexes (text, image, optional unified/cross-modal)
# - Late fusion (normalize + merge candidates)
# - Rerank/verify with hubness filters
# - Optional diversity enforcement

input:
  mode: multi_index
  
  # Multi-index configuration
  multi_index:
    # Text index (primary)
    text_index_path: ""  # Will be set by benchmark script
    text_embeddings_path: ""  # Will be set by benchmark script
    text_metric: cosine
    
    # Image index (primary)
    image_index_path: ""  # Will be set by benchmark script
    image_embeddings_path: ""  # Will be set by benchmark script
    image_metric: cosine
    
    # Unified/cross-modal index (optional recall backstop, not primary)
    unified_index_path: null  # Optional
    unified_embeddings_path: null  # Optional
    unified_metric: cosine
  
  # Late fusion configuration
  late_fusion:
    enabled: true
    normalize_scores: true
    fusion_method: rrf  # rrf, weighted_sum, or max
    text_weight: 0.4
    image_weight: 0.4
    unified_weight: 0.2  # Lower weight for recall backstop
    rrf_k: 60  # RRF constant
    unified_top_k: null  # Use scan.k if null
  
  # Diversity enforcement (optional)
  diversity:
    enabled: false  # Enable for production
    min_distance: 0.3  # Minimum cosine distance between results
    max_results_per_cluster: null  # Optional max per cluster
  
  metadata_path: ""  # Will be set by benchmark script

index:
  type: flat  # Not used in multi_index mode
  params: {}

scan:
  k: 20
  num_queries: 2000
  query_sampling: mixed
  batch_size: 256
  mixed_proportions:
    real_queries: 0.0
    random_docs_as_queries: 0.6
    cluster_centroids: 0.4
  seed: 42
  ranking:
    method: vector  # Will use multi-index adapter automatically
    parallel_retrieval: true  # Enable parallel retrieval

detectors:
  hubness:
    enabled: true
    validate_exact: false
    use_rank_weights: true
    use_distance_weights: true
  cluster_spread:
    enabled: true
    num_clusters: 50
    batch_size: 512
  stability:
    enabled: false
  dedup:
    enabled: true
  
  concept_aware:
    enabled: true
    mode: metadata
    metadata_field: concept
    num_concepts: 10
    concept_hub_z_threshold: 3.5
    seed: 42
  
  modality_aware:
    enabled: true
    mode: metadata
    doc_modality_field: modality
    cross_modal_penalty: 1.5

scoring:
  weights:
    hub_z: 0.6
    cluster_spread: 0.2
    stability: 0.0
    boilerplate: 0.2
    concept_hub_z: 0.0
    cross_modal: 0.0

thresholds:
  policy: hybrid
  hub_z: 4.0
  percentile: 0.03
  medium_ratio: 0.5

output:
  out_dir: ""
  privacy_mode: false

